apiVersion: apps/v1
kind: Deployment
metadata:
  name: kube-app-version
spec:
  template:
    spec:
      containers:
        - name: kube-app-version
          image: ghcr.io/joostvdg/kube-app-version@sha256:4fc8847ff51ad6c3f645855a617329f6baf8fc4c0ba966944d7a52eb31f7f2ca
          env:
            - name: APP_REDIS_MODE
              value: "OPTIONAL"
            - name: APPS_COLLECT_ON_STARTUP
              value: "true"
            - name: VERSIONS_REFRESH_ON_STARTUP
              value: "false"
            - name: VERSIONS_INTERVAL_MILLIS
              value: "600000" # 3600000 = 1 hour, 10 minutes = 600000
            - name: VERSIONS_CACHE_VALIDITY_MINUTES
              value: "20"
            - name: LOGGING_LEVEL_net_joostvdg_kube_app_version
              value: "DEBUG"
            - name: GITHUB_TOKEN
              valueFrom:
                secretKeyRef:
                  name: github-token
                  key: token
            - name: REDIS_HOST
              value: redis-master
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: redis
                  key: redis-password
          resources:
            requests:
              memory: "512Mi"
              cpu: "1000m"
            limits:
              memory: "1Gi"
